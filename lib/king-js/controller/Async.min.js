king.controller=king.controller||{};king.controller.NameAsync=king.controller.NameAsync||"king.controller.Async";
king.controller.NewAsync=king.controller.NewAsync||function(){var n=king.controller,e=king.NewObject(),d="none",g=[],h=0,k,f,m,l;e.Extend(n.NameAsync,{Status:function(){return d},Sync:function(a,b){g.push({Func:a,OnError:b});return this},Notify:function(a){if("runing"!=d)return this.log("Notify","Async not runing"),this;a||(a={});var b=a.Error,c=a.Content;c||(c=null);if(b){d="error";a=m;var e=!0;a&&(e=a(b,c));e&&l&&l(b,c);f&&f(b,c)}else return b=null,g.length>h?(b=g[h],m=b.OnError,b.Func(this,a.Content),
++h):(d="ok",k&&k(c),f&&f(b,c)),this},Do:function(a){if("none"!=d)return this.log("Notify","Async status must be none"),this;d="runing";a||(a={});k=a.Ok;f=a.End;l=a.Error;this.Notify({});return this}});return e};
